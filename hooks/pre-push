#!/bin/bash
# Pre-push hook: Run smoke test before allowing push
# Blocks push if any test fails

echo "Running Duro smoke test suite..."
cd "$(git rev-parse --show-toplevel)"

python smoke_test.py
EXIT_CODE=$?

if [ $EXIT_CODE -ne 0 ]; then
    echo ""
    echo "====================================="
    echo "PUSH BLOCKED: Smoke test failed"
    echo "Fix the failing tests before pushing"
    echo "====================================="
    exit 1
fi

echo "Smoke test passed. Proceeding with push."
exit 0
